language: java

jdk:
- oraclejdk8

install: echo "skip 'gradle assemble' step"
#script: gradle build --continue --parallel
script:
 - mkdir -p build/libs
 - echo "$TRAVIS_JOB_ID $TRAVIS_BUILD_NUMBER $TRAVIS_REPO_SLUG $TRAVIS_JOB_NUMBER $TRAVIS_COMMIT $TRAVIS_PULL_REQUEST" > build/libs/build.txt
 - cat build/libs/build.txt

before_cache:
- rm -f $HOME/.gradle/caches/modules-2/modules-2.lock
- rm -rf $HOME/.gradle/caches/*/scripts

cache:
  directories:
  - $HOME/.gradle/caches/
  - $HOME/.gradle/wrapper/

before_deploy:
  - mkdir /tmp/deploy
  - ls build/libs

deploy:
  on:
    all_branches: true
    condition: -v DEPLOY_S3_SECRET_KEY_ID
  provider: s3
  access_key_id: ${DEPLOY_S3_SECRET_KEY_ID}
  secret_access_key: ${DEPLOY_S3_SECRET_KEY}
  bucket: ${DEPLOY_S3_BUCKET}
  skip_cleanup: true
  local-dir: /tmp/deploy
  upload-dir: travis_artifacts/${TRAVIS_REPO_SLUG}/${TRAVIS_BUILD_NUMBER}/${TRAVIS_JOB_NUMBER}
  acl: public_read
